<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nimrod. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Lazy reST error handling</title>
<style type="text/css">

body {
  color: black;
  background: white;
}

span.DecNumber {color: blue}
span.BinNumber {color: blue}
span.HexNumber {color: blue}
span.OctNumber {color: blue}
span.FloatNumber {color: blue}
span.Identifier  {color: black}
span.Keyword {font-weight: bold}
span.StringLit {color: blue}
span.LongStringLit {color: blue}
span.CharLit {color: blue}
span.EscapeSequence {color: black}
span.Operator {color: black}
span.Punctation {color: black}
span.Comment, span.LongComment {font-style:italic; color: green}
span.RegularExpression  {color: DarkViolet}
span.TagStart {color: DarkViolet}
span.TagEnd {color: DarkViolet}
span.Key  {color: blue}
span.Value  {color: black}
span.RawData {color: blue}
span.Assembler  {color: blue}
span.Preprocessor {color: DarkViolet}
span.Directive  {color: DarkViolet}
span.Command, span.Rule, span.Hyperlink, span.Label, span.Reference, 
span.Other  {color: black}

div.navigation {
  -moz-border-radius: 5px 5px 5px 5px;
  float: left; 
  width: 30%;
  margin: 0; padding: 0;
  border: 3px outset #7F7F7F;
  background-color: #7F7F7F;
}

div.navigation ul {
  list-style-type: none;
  padding-left: 1em;
}
div.navigation ul li a, div.navigation ul li a:visited {
  font-weight: bold;
  color: #FFFFFF;
  text-decoration: none;
}
div.navigation ul li a:hover {
  font-weight: bold;
  text-decoration: none;
  color: gold;
}

div.content {
  margin-left: 30%;
  padding: 0 1em;
  border-left: 4em;
}

dl.item dd, dl.item dd p {
  margin-top:3px;
}
dl.item dd pre {
  margin-left: 15pt;
  border: 0px;
}
dl.item dt, dl.item dt pre {
  margin:  20pt 0 0 5pt;
}

pre, span.tok {
  background-color: #F9F9F9;
  border-color: #C4C4C4;
  border-style: solid;
  border-width: 1px 1px 1px 2px;
  color: black;
  line-spacing: 110%;
  padding: 2px;
}

span.red {
  color: #A80000;
}

hr {background-color:#9D9D9D; border:0 none; color:#9D9D9D; height:1px; width:100%;}

/*
:Author: David Goodger
:Contact: goodger@python.org
:Date: Date: 2006-05-21 22:44:42 +0200 (Sun, 21 May 2006)
:Revision: Revision: 4564
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/
/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th { border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first { margin-top: 0 ! important }
.last, .with-subtitle { margin-bottom: 0 ! important }
.hidden { display: none }
a.toc-backref { text-decoration: none ; color: black }
blockquote.epigraph { margin: 2em 5em ; }
dl.docutils dd { margin-bottom: 0.5em }
div.abstract { margin: 2em 5em }
div.abstract p.topic-title { font-weight: bold ; text-align: center }
div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ; border: medium outset ; padding: 1em }
div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title { font-weight: bold ; font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title { color: red ; font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication { margin: 2em 5em ; text-align: center ; font-style: italic }
div.dedication p.topic-title { font-weight: bold ; font-style: normal }
div.figure { margin-left: 2em ; margin-right: 2em }
div.footer, div.header { clear: both; font-size: smaller }
div.line-block { display: block ; margin-top: 1em ; margin-bottom: 1em }
div.line-block div.line-block { margin-top: 0 ; margin-bottom: 0 ;
  margin-left: 1.5em }
div.sidebar { margin-left: 1em ; border: medium outset ;
  padding: 1em ; background-color: #ffffee ; /*width: 40% ;*/ float: right ;
  clear: right }

div.sidebar p.rubric { font-family: sans-serif ; font-size: medium }
div.system-messages { margin: 5em }
div.system-messages h1 { color: red }
div.system-message { border: medium outset ; padding: 1em }
div.system-message p.system-message-title { color: red ; font-weight: bold }
div.topic { margin: 2em;}
h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }
h1.title { text-align: center }
h2.subtitle { text-align: center }
/* hr.docutils { width: 75% } */
img.align-left { clear: left }
img.align-right { clear: right }
ol.simple, ul.simple { margin-bottom: 1em }
ol.arabic { list-style: decimal }
ol.loweralpha { list-style: lower-alpha }
ol.upperalpha { list-style: upper-alpha }
ol.lowerroman { list-style: lower-roman }
ol.upperroman { list-style: upper-roman }
p.attribution { text-align: right ; margin-left: 50% }
p.caption { font-style: italic }
p.credits { font-style: italic ; font-size: smaller }
p.label { white-space: nowrap }
p.rubric { font-weight:bold;font-size:larger;color:maroon;text-align:center}
p.sidebar-title {font-family: sans-serif ;font-weight: bold ;font-size: larger }
p.sidebar-subtitle {font-family: sans-serif ; font-weight: bold }
p.topic-title {
font-weight: bold;
background-color: #6D6D6D;
border-bottom: 1px solid #000000;
border-top: 1px solid black;
color: white;
text-align: center;
margin: 0;
}
pre.address { margin-bottom: 0;margin-top:0;font-family:serif;font-size:100% }
pre.literal-block, pre.doctest-block {margin-left: 2em ;margin-right: 2em }
span.classifier {font-family: sans-serif;font-style: oblique }
span.classifier-delimiter {font-family: sans-serif;font-weight: bold }
span.interpreted {font-family: sans-serif }
span.option {white-space: nowrap }
span.pre {white-space: pre }
span.problematic {color: red }
span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation { border-left: solid 1px gray; margin-left: 1px }
table.docinfo {margin: 2em 4em }
table.docutils {margin-top: 0.5em;margin-bottom: 0.5em; border: 0 solid #9d9d9d; border-collapse: collapse; }
table.footnote {border-left: solid 1px black;margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {padding-left: 0.5em;padding-right: 0.5em;
  vertical-align: top;}

table.docutils td, table.docutils th { border-bottom:1px solid #9D9D9D; }
/* color: #4d4d4d} */

/* table.docutils td:hover, table.docinfo td:hover {color: #000000} */
  

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold;text-align: left;white-space: nowrap;padding-left: 0 }
  
table.docutils th
{
color: black;
font-weight:normal;
background-color: #E3E3E3;
border-top: 1px solid #1d1d1d;
border-bottom: 1px solid #1d1d1d;
}
  
h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {font-size: 100% }
ul.auto-toc { list-style-type: none }
/*a.reference { color: #E00000; font-weight:bold;}
a.reference:hover {color: #E00000;background-color: #ffff00;display: margin;
  font-weight:bold;}*/

</style>

</head>
<body>
<div class="document" id="documentId">
<h1 class="title">Lazy reST error handling</h1>
<p>This document describes how error handling is done by <a class="reference external" href="https://github.com/gradha/lazy_rest">Lazy reSt</a>.  See also the main <a class="reference external" href="../README.html">README</a>.</p>

<h1 id="introduction-and-test-cases">Introduction and test cases</h1><p>Error handling transforming  reStructuredText files involves two variables: user inputs and code.  The inputs are  reStructuredText files which you feed to the code. Inputs can be valid, but they can also contain syntax errors. Code can be valid, but it can contain errors or handle incorrectly corner cases. There are also situations out of reach for the code which will affect the software (e.g. invalid permissions reading input files).</p>
<p>Problems in  reStructuredText inputs are typically handled during parsing, the parser will stop processing the input and will bail out with an error and hopefully a line/column number the user can go to in order to fix the input. Code errors are mitigated through the wrapping of all code inside <tt class="docutils literal"><span class="pre">try/catch</span></tt> blocks.  In both cases ( reStructuredText inputs and code errors), the exception handling will still try to present a valid HTML to the user (for <em>peculiar</em> values of the word <tt class="docutils literal"><span class="pre">valid</span></tt>).</p>
<p>In the <tt class="docutils literal"><span class="pre">tests/errors</span></tt> subdirectory of the Lazy reST project you can find <tt class="docutils literal"><span class="pre">test_errors.nim</span></tt>. Compiling and running this program will generate multiple HTML files which show how the software reacts to different user input and code errors. Files with the name pattern <tt class="docutils literal"><span class="pre">normal_*.html</span></tt> will contain the default error page generated by the software. Files with the name pattern <tt class="docutils literal"><span class="pre">forced_*.html</span></tt> will contain a special static <em>last case</em> attempt at handling errors. You can look at these files to check what the user will see when the <tt class="docutils literal"><span class="pre">safe_*</span></tt> procs of Lazy reST are used. In general they will try to show a redirection to the GitHub issue tracker, the list of errors, and the raw user input for inspection.</p>

<h1 id="error-pages">Error pages</h1><p>The <tt class="docutils literal"><span class="pre">normal_*.html</span></tt> files show roughly the same content as the one produced from the file <a class="reference external" href="../tests/errors/default_error_html_template.rst">default_error_html_template.rst</a> . The <tt class="docutils literal"><span class="pre">forced_*.html</span></tt> files will show roughly the same content as the one produced from the file <a class="reference external" href="../tests/errors/safe_error_html_template.rst">safe_error_html_template.rst</a>.</p>
<p>Internally when something goes wrong, Lazy reST will try to show the normal error page. This page still involves a degree of runtime uncertainty and could fail despite all attempts to prevent this from happening. It is in this extreme cases that the second type of error page is displayed. This one is completely static and is built based on simple string concatenation. If this one fails too, it means the process/machine has reached a critical unrecoverable point and pretty much nothing in software can be done about it.</p>
<p>To render the second <em>failsafe</em> static error, a special configuration variable is used to force an error during the normal generation.</p>

<h1 id="customization-of-the-error-page">Customization of the error page</h1><p>Lazy reST allows you to set up different error pages which will be displayed to the user. Through the <a class="reference external" href="../lazy_rest.html#set_normal_error_rst">set_normal_error_rst()</a> and <a class="reference external" href="../lazy_rest.html#set_safe_error_rst">set_safe_error_rst()</a>  procs you can set both the normal and static error pages to either point at your own online GitHub issue/support tracker, or maybe because you want to internationalize the help text. The normal error page (just like the normal <a class="reference external" href="../lazy_rest_pkg/lconfig.html#lrc_render_template">success page</a>) allows <a class="reference external" href="http://nimrod-lang.org/subexes.html">substitution expression (subexe) interpolations</a> with the following <em>dollar</em> variables:</p>
<ul class="simple"><li><a class="reference external" href="../lazy_rest_pkg/lconfig.html#lrk_render_title">lrk_render_title</a>.</li>
<li><a class="reference external" href="../lazy_rest_pkg/lconfig.html#lrk_render_date">lrk_render_date</a>.</li>
<li><a class="reference external" href="../lazy_rest_pkg/lconfig.html#lrk_render_time">lrk_render_time</a>.</li>
<li><a class="reference external" href="../lazy_rest_pkg/lconfig.html#lrk_render_local_date">lrk_render_local_date</a>.</li>
<li><a class="reference external" href="../lazy_rest_pkg/lconfig.html#lrk_render_local_time">lrk_render_local_time</a>.</li>
<li><a class="reference external" href="../lazy_rest_pkg/lconfig.html#lrk_render_file_time">lrk_render_file_time</a>.</li>
<li><a class="reference external" href="../lazy_rest_pkg/lconfig.html#lrk_render_content">lrk_render_content</a>.</li>
<li><a class="reference external" href="../lazy_rest_pkg/lconfig.html#lrk_render_version_str">lrk_render_version_str</a>.</li>
<li><a class="reference external" href="../lazy_rest_pkg/lconfig.html#lrk_render_error_table">lrk_render_error_table</a>.</li>
</ul>
<p>If any of these values can't be provided by the library (e.g. input file is missing, thus no date/time values can be extracted) the empty string will be used instead. You don't need to include these in your error template, they are optional.  Rendered pages without errors also use the following additional subexes to embed the Prism JavaScript code:</p>
<ul class="simple"><li><a class="reference external" href="../lazy_rest_pkg/lconfig.html#lrk_render_prism_js">lrk_render_prism_js</a>.</li>
<li><a class="reference external" href="../lazy_rest_pkg/lconfig.html#lrk_render_prism_css">lrk_render_prism_css</a>.</li>
</ul>
<p>In any case, the file <tt class="docutils literal"><span class="pre">tests/errors/default_error_html_template.rst</span></tt> is not used directly by Lazy reST, some modifications are done, you can see the real error file at <a class="reference external" href="https://github.com/gradha/lazy_rest/blob/master/resources/error_html.template">resources/error_html.template</a>.</p>
<p>Also, the static error page doesn't use subexe interpolation and is split into two parts with the actual error messages and content sandwiched between <a class="reference external" href="https://github.com/gradha/lazy_rest/blob/master/resources/safe_error_start.template">resources/safe_error_start.template</a> and <a class="reference external" href="https://github.com/gradha/lazy_rest/blob/master/resources/safe_error_end.template">resources/safe_error_end.template</a>. When you use <a class="reference external" href="../lazy_rest.html#set_safe_error_rst">set_safe_error_rst()</a> to specify the safe error page, on top of being valid reStructuredText input, the final HTML <strong>has</strong> to contain the string <tt class="docutils literal"><span class="pre">$content</span></tt> somewhere. This string is used as a marker to split the begin/end of the HTML error page for later concatenation.</p>
<p>If you want to test your customized error pages, feel free to modify the files <tt class="docutils literal"><span class="pre">tests/errors/custom_*_error.rst</span></tt> and rerun <tt class="docutils literal"><span class="pre">tests/errors/test_errors.nim</span></tt> to see what your users will look at (hopefully not very often). After running <tt class="docutils literal"><span class="pre">test_errors.nim</span></tt> you can find the simulated output of these errors rendered in the <tt class="docutils literal"><span class="pre">tests/errors/output</span></tt> directory. </p>

<small>Last modified: 2014-12-10 23:12 UTC. Local time: 2014-12-11 00:12.
<div id="counter"></div>
</small>
<br>Rendered by lazy_rest 0.2.0.
</div>
</body>
<script type="text/javascript">
// Time difference code from http://stackoverflow.com/q/11479170/172690
function timeDifference(current, previous) {
    var msPerMinute = 60 * 1000;
    var msPerHour = msPerMinute * 60;
    var msPerDay = msPerHour * 24;
    var msPerMonth = msPerDay * 30;
    var msPerYear = msPerDay * 365;

    var elapsed = current - previous;

    if (elapsed < msPerMinute) {
         return Math.round(elapsed/1000) + ' seconds ago';
    } else if (elapsed < msPerHour) {
         return Math.round(elapsed/msPerMinute) + ' minutes ago';
    } else if (elapsed < msPerDay ) {
         return Math.round(elapsed/msPerHour ) + ' hours ago';
    } else if (elapsed < msPerMonth) {
         return 'approximately ' + Math.round(elapsed/msPerDay) + ' days ago';
    } else if (elapsed < msPerYear) {
         return 'approximately ' + Math.round(elapsed/msPerMonth) + ' months ago';
    } else {
         return 'approximately ' + Math.round(elapsed/msPerYear ) + ' years ago';
    }
}

// Timer base code taken from http://stackoverflow.com/a/11876480/172690
window.onload = function() {
    var fileTime = new Date(1418253171000);
	var ctr = document.getElementById("counter");

    function incrementCounter() {
		var nowTime = new Date();
		var relTime = timeDifference(nowTime, fileTime)
		ctr.innerHTML = relTime;
		// Update ourselves in the future, every five seconds.
		setTimeout(incrementCounter, 5000);
    }

    incrementCounter();
}
</script>

</html>
